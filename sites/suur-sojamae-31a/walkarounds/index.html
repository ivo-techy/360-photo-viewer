<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Walkarounds</title>
  <style>
    :root { --bg:#0f1115; --panel:#171a21; --border:#222733; --text:#e6e6e6; --muted:#9aa0a6; --btn:#1e2330; --btnh:#252c3b; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
    .wrap{max-width:900px;margin:40px auto;padding:0 16px}
    h1{margin:0 0 6px;font-size:1.75rem}
    p.note{margin:0 0 18px;color:var(--muted)}
    .toolbar{display:flex;justify-content:space-between;align-items:center;margin:8px 0 16px}
    .search{width:280px;max-width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:var(--bg);color:var(--text)}
    .list{display:grid;gap:12px}
    .item{display:flex;justify-content:space-between;align-items:center;padding:16px;border:1px solid var(--border);background:var(--panel);border-radius:16px}
    .date{font-weight:600;letter-spacing:.2px}
    .btn{display:inline-block;padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:var(--btn);color:var(--text);text-decoration:none}
    .btn:hover{background:var(--btnh)}
    .empty{margin-top:16px;color:var(--muted)}
    .error{margin-top:16px;color:#ffb4b4;white-space:pre-wrap}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Walkarounds</h1>
    <p class="note">Newest first. Click a date to open that day’s 360 viewer.</p>

    <div class="toolbar">
      <input id="q" class="search" type="search" placeholder="Filter dates…" />
    </div>

    <div id="list" class="list" aria-live="polite"></div>
    <div id="msg" class="empty" hidden>No walkarounds found.</div>
    <div id="err" class="error" hidden></div>
  </div>

  <script>
    (async function () {
      const list = document.getElementById('list');
      const msg  = document.getElementById('msg');
      const err  = document.getElementById('err');
      const q    = document.getElementById('q');

      try {
        const res = await fetch('walkarounds.json', { cache: 'no-store' });
        if (!res.ok) throw new Error(`HTTP ${res.status} ${res.statusText}`);
        let dates = await res.json();
        if (!Array.isArray(dates)) throw new Error('walkarounds.json must be an array of date strings like "YYYY.MM.DD".');

        // sort desc (expects YYYY.MM.DD)
        const key = s => s.replaceAll('.', ''); // 2025.08.15 -> 20250815
        dates.sort((a,b) => Number(key(b)) - Number(key(a)));

        const render = () => {
          const term = q.value.trim().toLowerCase();
          list.innerHTML = '';
          let count = 0;

          for (const d of dates) {
            if (term && !d.toLowerCase().includes(term)) continue;

            const row = document.createElement('div');
            row.className = 'item';

            const dateEl = document.createElement('div');
            dateEl.className = 'date';
            dateEl.textContent = d;

            const link = document.createElement('a');
            link.className = 'btn';
            link.href = `${d}/`;           // expects /walkarounds/<date>/index.html inside
            link.textContent = 'Open';

            row.appendChild(dateEl);
            row.appendChild(link);
            list.appendChild(row);
            count++;
          }

          msg.hidden = count !== 0;
        };

        render();
        q.addEventListener('input', render);
      } catch (e) {
        err.hidden = false;
        err.textContent = 'Failed to load walkarounds.json:\n' + (e && e.message ? e.message : e);
      }
    })();
  </script>
</body>
</html>
